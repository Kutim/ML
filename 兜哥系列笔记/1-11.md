# Apriori与FP-growth算法

关联算法，属于无监督算法，可以自动从数据中挖掘出潜在的关联关系。

## 11.1  Apriori算法概述

​	首先介绍三个基本概念：支持度、置信度、频繁k项集

​	支持度，P(AnB)，既有A又有B的概率，它表现的是A和B两个事件相对整个数据集合同事发生的频繁程度。

​	置信度，P(B|A)，在A发生的事件中同时发生B的概率 P(AB)/P(A)，它表现的是在AB两个事件的相关程度，和整个数据集合的大小没有关系。

​	如果事件A中包含k个元素，那么称这个事件A，为k项集事件A。满足最小支持度阈值的事件称为频繁k项集。

​	Aprior算法就是挖掘同时满足最小支持度阈值和最小置信度阈值的关联和规则。

​	Aprior算法使用频繁项集的先验知识，使用一种称为“逐层搜索”的迭代方法，k项集用于探索（k+1）项集。首先，通过扫描事物记录，找出所有的频繁1项集，该集合记做L1，然后利用L1找频繁2项集的集合L2，如此下去，直到不能再找到任何频繁k项集。最后再在所有的频繁集中找出强规则，即产生用户感兴趣的关联规则。

​	Aprior算法具有这样一条性质：任一频繁项集的所有非空子集也必须是频繁的。

- 扫描数据库并计数，计算每个商品对应的支持度；
- 根据设置的支持度筛选满足需求的L1；
- 两两连接，获得新的数据集合，并重新扫描计数；
- 如此循环，直到出现满足设置的支持度的全部集合出现。

## 11.3 使用Apriori算法挖掘XSS相关参数

​	在安全领域，Apriopri的应用非常广泛，凡是需要挖掘潜在关联关系的都可以尝试使用，比如关联WAF的accesslog与后端数据库的sqllog，识别ssh操作日志中异常操作等。

​	我们从xssed网站的样例以及WAF的拦截日志中提取XSS攻击的日志作为样本。

​	我们目标是分析潜在的关联关系，然后作为SVM、KNN等分类算法的特征提取依据之一。（机器学习没有办法直接识别日志，需要逐行将日志文本向量化，最简单的方式就是按照一定的分割符切割成单词向量）

​	我们已十分严格的置信度来运行，试图找到关联关系接近100%的情况。

​	出现了匪夷所思的结果，比如 ‘a’和‘c’出现的话，会100%导致‘m’。

​	我们将支持度下降到0.001，这意味着即使对应的关联关系出现的概率只有千分之一，只要它对应的是强关联，置信度超过0.99，我们也认为这是一种有价值的关联。

## 11.4 FP-growth 算法概述

​	FP-growth 算法基于 Apriori构建，但采用了高级的数据结构减少扫描次数，大大加快了算法速度。FP-growth 算法只需要对数据库进行两次扫描。

​	FP-growth算法发现频繁项集的基本过程：

- 构建FP 树；
- 从FP树中挖掘频繁项集

## 11.5 FP-growth示例

​	FP-growth算法有大量开源实现，名气较大的是pyfpgrowth

# 11.6 使用FP-growth算法挖掘疑似僵尸主机示例

​	通过使用FP-growth算法，分析防火墙的拦截日志，挖掘出浏览器的user-agent字段和被攻击的目标url之间的关联关系，初步确定潜在的僵尸主机。

